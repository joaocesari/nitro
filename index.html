<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Votação de Imagens</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f8f8f8;
    }
    h1 {
      text-align: center;
    }
    .image-container {
      border: 1px solid #ccc;
      background: #fff;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
      max-width: 400px;
    }
    img {
      max-width: 100%;
      border-radius: 5px;
      margin-top: 10px;
    }
    .gallery {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    .voted-message {
      text-align: center;
      font-size: 18px;
      color: green;
    }
  </style>
</head>
<body>

<h1>Vote na sua imagem favorita</h1>
<div id="gallery" class="gallery"></div>

<script>
  const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRbJ6Jv71Ut09dddq-p7xAElfSkATlotEHjwog3EHOsQ5fCsHPzl5UhHREKMeRm4cwywBXpb6--3pey/pubhtml";
  const votedKey = 'imagem_votada';

  fetch(sheetUrl)
    .then(res => res.json())
    .then(data => {
      const voted = localStorage.getItem(votedKey);
      const gallery = document.getElementById("gallery");

      if (voted) {
        gallery.innerHTML = `<p class="voted-message">Você já votou. Obrigado pela sua participação!</p>`;
        return;
      }

      data.forEach((item, index) => {
        const nome = item["Nome"] || "Participante";
        const titulo = item["Título da Imagem"] || "Sem título";
        const link = item["Link da Imagem"];

        // Captura o ID da imagem no Drive
        const match = link.match(/[-\w]{25,}/);
        if (!match) return;
        const fileId = match[0];
        const imgUrl = `https://drive.google.com/uc?export=view&id=${fileId}`;

        const container = document.createElement("div");
        container.className = "image-container";
        container.innerHTML = `
          <h3>${titulo}</h3>
          <p>por <strong>${nome}</strong></p>
          <img src="${imgUrl}" alt="${titulo}">
          <button onclick="votar(${index})">Votar nesta imagem</button>
        `;
        gallery.appendChild(container);
      });
    });

  function votar(index) {
    localStorage.setItem('imagem_votada', index);
    alert("Obrigado pelo seu voto!");
    location.reload();
  }
</script>

</body>
</html>
